ﬁ
WC:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\ViewModels\GenericViewModels.cs
	namespace 	
Agah
 
. 

ViewModels 
{ 
public 

class 
ResponseStatus 
{ 
public 
int 

StatusCode 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
StatusMessage #
{$ %
get& )
;) *
set+ .
;. /
}0 1
} 
} À'
WC:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Services\NotificationService.cs
	namespace 	
Agah
 
. 
Services 
{ 
public		 

class		 
NotificationService		 $
{

 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
public 
NotificationService "
(" #
IUnitOfWork# .

unitOfWork/ 9
)9 :
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
public 
async 
Task 
< 
ResponseStatus (
>( )
SendNotification* :
(: ;'
Notification_MessageOptions; V
messageOptionsW e
)e f
{ 	
try 
{ 
var 
alarm 
= 
_unitOfWork '
.' (
AlarmRepository( 7
.7 8
GetFirstOrDefault8 I
(I J
uJ K
=>L N
uO P
.P Q
EnglishNameQ \
==] _
messageOptions` n
.n o
NotificationTypeo 
)	 Ä
;
Ä Å
if 
( 
alarm 
== 
null !
||" $
alarm% *
.* +
IsActive+ 3
==4 6
false7 <
)< =
return 
new 
ResponseStatus -
(- .
). /
{0 1

StatusCode2 <
== >
$num? B
,B C
StatusMessageD Q
=R S
$str	T é
}
è ê
;
ê ë
switch 
( 
alarm 
. 
EnglishName )
)) *
{ 
case 
$str  
:  !
var !
notificationsToRemove 1
=2 3
_unitOfWork4 ?
.? @'
Notification_UserRepository@ [
. 
GetAll #
(# $
)$ %
.   
Where   "
(  " #
n  # $
=>  % '
n  ( )
.  ) *
UserId  * 0
==  1 3
messageOptions  4 B
.  B C
User  C G
.  G H
Id  H J
)  J K
.!! 
OrderByDescending!! .
(!!. /
n!!/ 0
=>!!1 3
n!!4 5
.!!5 6
	CreatedAt!!6 ?
)!!? @
."" 
Skip"" !
(""! "
$num""" #
)""# $
.## 
ToList## #
(### $
)##$ %
;##% &
if&& 
(&& !
notificationsToRemove&& 1
.&&1 2
Any&&2 5
(&&5 6
)&&6 7
)&&7 8
_unitOfWork'' '
.''' ('
Notification_UserRepository''( C
.''C D
RemoveRange''D O
(''O P!
notificationsToRemove''P e
)''e f
;''f g
_unitOfWork)) #
.))# $'
Notification_UserRepository))$ ?
.))? @
Add))@ C
())C D
new))D G
Notification_User))H Y
())Y Z
)))Z [
{** 
UserId++ "
=++# $
messageOptions++% 3
.++3 4
User++4 8
.++8 9
Id++9 ;
,++; <
MessageSubject,, *
=,,+ ,
messageOptions,,- ;
.,,; <
MessageSubject,,< J
,,,J K
MessageContent-- *
=--+ ,
messageOptions--- ;
.--; <
MessageContent--< J
,--J K
}.. 
).. 
;.. 
await// 
_unitOfWork// )
.//) *
	SaveAsync//* 3
(//3 4
)//4 5
;//5 6
return00 
new00 "
ResponseStatus00# 1
(001 2
)002 3
{004 5

StatusCode006 @
=00A B
$num00C F
,00F G
StatusMessage00H U
=00V W
$str00X s
}00t u
;00u v
default11 
:11 
break22 
;22 
}33 
return55 
new55 
ResponseStatus55 )
(55) *
)55* +
{55, -

StatusCode55. 8
=559 :
$num55; >
,55> ?
StatusMessage55@ M
=55N O
$str55P k
}55l m
;55m n
}66 
catch77 
(77 
	Exception77 
ex77 
)77  
{88 
return99 
new99 
ResponseStatus99 )
(99) *
)99* +
{99, -

StatusCode99. 8
=999 :
$num99; >
,99> ?
StatusMessage99@ M
=99N O
$"99P R
$str99R p
{99p q
ex99q s
.99s t
Message99t {
}99{ |
"99| }
}99~ 
;	99 Ä
}:: 
};; 	
}<< 
}== ≤&
QC:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Services\ApiJobService.cs
	namespace 	
Agah
 
. 
Services 
{ 
public 

static 
class 
ApiJobService %
{ 
public		 
static		 
async		 
Task		  #
CallUpdateProductLogApi		! 8
(		8 9
)		9 :
{

 	
using 
( 

HttpClient 
client $
=% &
new' *

HttpClient+ 5
(5 6
)6 7
)7 8
{ 
string 
apiUrl 
= 
$str  V
;V W
try 
{ 
HttpResponseMessage '
response( 0
=1 2
await3 8
client9 ?
.? @
GetAsync@ H
(H I
apiUrlI O
)O P
;P Q
response 
. #
EnsureSuccessStatusCode 4
(4 5
)5 6
;6 7
string 
result !
=" #
await$ )
response* 2
.2 3
Content3 :
.: ;
ReadAsStringAsync; L
(L M
)M N
;N O
Console 
. 
	WriteLine %
(% &
$"& (
$str( G
{G H
resultH N
}N O
"O P
)P Q
;Q R
} 
catch 
( 
	Exception  
ex! #
)# $
{ 
Console 
. 
	WriteLine %
(% &
$"& (
$str( L
{L M
exM O
.O P
MessageP W
}W X
"X Y
)Y Z
;Z [
} 
} 
} 	
public 
static 
async 
Task  (
CallCheckPriceInReservedsApi! =
(= >
)> ?
{ 	
using   
(   

HttpClient   
client   $
=  % &
new  ' *

HttpClient  + 5
(  5 6
)  6 7
)  7 8
{!! 
string"" 
apiUrl"" 
="" 
$str""  T
;""T U
try$$ 
{%% 
HttpResponseMessage&& '
response&&( 0
=&&1 2
await&&3 8
client&&9 ?
.&&? @
GetAsync&&@ H
(&&H I
apiUrl&&I O
)&&O P
;&&P Q
response'' 
.'' #
EnsureSuccessStatusCode'' 4
(''4 5
)''5 6
;''6 7
string(( 
result(( !
=((" #
await(($ )
response((* 2
.((2 3
Content((3 :
.((: ;
ReadAsStringAsync((; L
(((L M
)((M N
;((N O
var)) 
reservesList)) $
=))% &
JsonConvert))' 2
.))2 3
DeserializeObject))3 D
<))D E
List))E I
<))I J
Reserve))J Q
>))Q R
>))R S
())S T
result))T Z
)))Z [
;))[ \
string++ 
checkPriceUrl++ (
=++) *
$str+++ -
;++- .
foreach.. 
(.. 
var..  
reserve..! (
in..) +
reservesList.., 8
)..8 9
{// 
checkPriceUrl00 %
=00& '
$"00( *
$str00* g
{00g h
reserve00h o
.00o p
User_Id00p w
}00w x
"00x y
;00y z
response11  
=11! "
await11# (
client11) /
.11/ 0
GetAsync110 8
(118 9
checkPriceUrl119 F
)11F G
;11G H
response22  
.22  !#
EnsureSuccessStatusCode22! 8
(228 9
)229 :
;22: ;
result44 
=44  
await44! &
response44' /
.44/ 0
Content440 7
.447 8
ReadAsStringAsync448 I
(44I J
)44J K
;44K L
Console55 
.55  
	WriteLine55  )
(55) *
$"55* ,
$str55, C
{55C D
reserve55D K
.55K L
User_Id55L S
}55S T
$str55T V
{55V W
result55W ]
}55] ^
"55^ _
)55_ `
;55` a
}66 
}88 
catch99 
(99 
	Exception99  
ex99! #
)99# $
{:: 
Console;; 
.;; 
	WriteLine;; %
(;;% &
$";;& (
$str;;( Q
{;;Q R
ex;;R T
.;;T U
Message;;U \
};;\ ]
";;] ^
);;^ _
;;;_ `
}<< 
}== 
}>> 	
}?? 
}AA À$
BC:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder

 
.

 
Services

 
.

 
AddControllers

 
(

  
)

  !
;

! "
builder 
. 
Services 
. #
AddEndpointsApiExplorer (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddSwaggerGen 
( 
)  
;  !
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options? F
.F G
UseSqlServerG S
(S T
builder 
. 
Configuration 
. 
GetConnectionString -
(- .
$str. A
)A B
) 
) 
; 
builder 
. 
Services 
. 
	AddScoped 
< 
IUnitOfWork &
,& '

UnitOfWork( 2
>2 3
(3 4
)4 5
;5 6
builder 
. 
Services 
. 
AddCors 
( 
options  
=>! #
{ 
options 
. 
	AddPolicy 
( 
$str &
,& '
policy( .
=>/ 1
{ 
policy 
. 
WithOrigins 
( 
$str 2
)2 3
. 
AllowAnyMethod 
( 
) 
. 
AllowAnyHeader 
( 
) 
. 
AllowCredentials 
(  
)  !
;! "
} 
) 
; 
} 
) 
; 
builder!! 
.!! 
Services!! 
.!! 
AddHangfire!! 
(!! 
config!! #
=>!!$ &
config"" 

.""
 
UseSqlServerStorage"" 
("" 
builder"" &
.""& '
Configuration""' 4
.""4 5
GetConnectionString""5 H
(""H I
$str""I \
)""\ ]
)""] ^
)""^ _
;""_ `
builder## 
.## 
Services## 
.## 
AddHangfireServer## "
(##" #
)### $
;##$ %
var%% 
app%% 
=%% 	
builder%%
 
.%% 
Build%% 
(%% 
)%% 
;%% 
if'' 
('' 
app'' 
.'' 
Environment'' 
.'' 
IsDevelopment'' !
(''! "
)''" #
)''# $
{(( 
app)) 
.)) 

UseSwagger)) 
()) 
))) 
;)) 
app** 
.** 
UseSwaggerUI** 
(** 
)** 
;** 
}++ 
app-- 
.-- 
UseHttpsRedirection-- 
(-- 
)-- 
;-- 
app00 
.00 
UseCors00 
(00 
$str00 
)00 
;00 
app22 
.22 
UseAuthorization22 
(22 
)22 
;22 
app44 
.44  
UseHangfireDashboard44 
(44 
$str44 $
)44$ %
;44% &
app66 
.66 
MapControllers66 
(66 
)66 
;66 
RecurringJob88 
.88 
AddOrUpdate88 
(88 
$str99 
,99 
(:: 
):: 
=>:: 	
ApiJobService::
 
.:: #
CallUpdateProductLogApi:: /
(::/ 0
)::0 1
,::1 2
Cron;; 
.;; 	
Minutely;;	 
);; 
;;; 
RecurringJob== 
.== 
AddOrUpdate== 
(== 
$str>> 
,>> 
(?? 
)?? 
=>?? 	
ApiJobService??
 
.?? (
CallCheckPriceInReservedsApi?? 4
(??4 5
)??5 6
,??6 7
Cron@@ 
.@@ 	
Minutely@@	 
)@@ 
;@@ 
appAA 
.AA 
RunAA 
(AA 
)AA 	
;AA	 
ºâ
XC:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Controllers\ProductController.cs
	namespace

 	
Agah


 
.

 
Controllers

 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
ProductController "
:# $
ControllerBase% 3
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
public 
ProductController  
(  !
IUnitOfWork! ,

unitOfWork- 7
)7 8
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
HttpGet	 
( 
$str 
) 
]  
public 
async 
Task 
< 
IActionResult '
>' (
GetProducts) 4
(4 5
)5 6
{ 	
try 
{ 
var 
list 
= 
_unitOfWork &
.& '
ProductRepository' 8
.8 9
GetAll9 ?
(? @
)@ A
.A B
SelectB H
(H I
uI J
=>J L
newM P
{Q R
uS T
.T U
IdU W
,W X
uY Z
.Z [
PersianName[ f
,f g
uh i
.i j
IconNamej r
}s t
)t u
.u v
ToListv |
(| }
)} ~
;~ 
return 
Ok 
( 
new 
{ 
result %
=& '
list( ,
}, -
)- .
;. /
} 
catch   
(   
	Exception   
ex   
)    
{!! 
return"" 

BadRequest"" !
(""! "
$"""" $
$str""$ /
{""/ 0
ex""0 2
.""2 3
Message""3 :
}"": ;
$str""; O
"""O P
)""P Q
;""Q R
}## 
}$$ 	
[&& 	
HttpGet&&	 
(&& 
$str&& !
)&&! "
]&&" #
public'' 
async'' 
Task'' 
<'' 
IActionResult'' '
>''' (
GetProductsLog'') 7
(''7 8
)''8 9
{(( 	
try)) 
{** 
var++ 
list++ 
=++ 
_unitOfWork++ &
.++& ' 
ProductLogRepository++' ;
.++; <
GetAll++< B
(++B C
includeProperties++C T
:++T U
u++V W
=>++W Y
u++Z [
.++[ \
Product++\ c
)++c d
.,, 
OrderByDescending,, &
(,,& '
u,,' (
=>,,( *
u,,+ ,
.,,, -
	CreatedAt,,- 6
),,6 7
.-- 
GroupBy-- 
(-- 
u-- 
=>-- !
u--" #
.--# $

Product_Id--$ .
)--. /
... 
Select.. 
(.. 
g.. 
=>..  
g..! "
..." #
First..# (
(..( )
)..) *
)..* +
.// 
Select// 
(// 
u// 
=>//  
new//! $(
Product_ProductLog_ViewModel//% A
(//A B
)//B C
{00 

Product_Id11 "
=11# $
u11% &
.11& '

Product_Id11' 1
,111 2
ProductName22 #
=22$ %
u22& '
.22' (
Product22( /
.22/ 0
PersianName220 ;
,22; <
ProductIconName33 '
=33( )
u33* +
.33+ ,
Product33, 3
.333 4
IconName334 <
,33< =
Price44 
=44 
u44  !
.44! "
Price44" '
.44' (
ToString44( 0
(440 1
$str441 5
)445 6
,446 7
CreateAt55  
=55! "
u55# $
.55$ %
	CreatedAt55% .
.55. /
ToString55/ 7
(557 8
)558 9
,559 :
Unit66 
=66 
$str66 %
}77 
)77 
.77 
ToList77 
(77 
)77 
;77  
return99 
Ok99 
(99 
new99 
{99 
result99  &
=99' (
list99) -
}99. /
)99/ 0
;990 1
}:: 
catch;; 
(;; 
	Exception;; 
ex;; 
);;  
{<< 
return== 

BadRequest== !
(==! "
$"==" $
$str==$ /
{==/ 0
ex==0 2
.==2 3
Message==3 :
}==: ;
$str==; O
"==O P
)==P Q
;==Q R
}>> 
}?? 	
[AA 	
HttpGetAA	 
(AA 
$strAA 
)AA  
]AA  !
publicBB 
asyncBB 
TaskBB 
<BB 
IActionResultBB '
>BB' (
SeedProductsBB) 5
(BB5 6
)BB6 7
{CC 	
stringDD 
urlDD 
=DD 
$strDD N
;DDN O
usingFF 
(FF 

HttpClientFF 

httpClientFF (
=FF) *
newFF+ .

HttpClientFF/ 9
(FF9 :
)FF: ;
)FF; <
{GG 
tryHH 
{II 
HttpResponseMessageJJ '
responseJJ( 0
=JJ1 2
awaitJJ3 8

httpClientJJ9 C
.JJC D
GetAsyncJJD L
(JJL M
urlJJM P
)JJP Q
;JJQ R
responseKK 
.KK #
EnsureSuccessStatusCodeKK 4
(KK4 5
)KK5 6
;KK6 7
stringMM 
responseBodyMM '
=MM( )
awaitMM* /
responseMM0 8
.MM8 9
ContentMM9 @
.MM@ A
ReadAsStringAsyncMMA R
(MMR S
)MMS T
;MMT U
varNN 
apiResponseNN #
=NN$ %
JsonConvertNN& 1
.NN1 2
DeserializeObjectNN2 C
<NNC D

DictionaryNND N
<NNN O
stringNNO U
,NNU V
stringNNW ]
>NN] ^
>NN^ _
(NN_ `
responseBodyNN` l
)NNl m
;NNm n
ifPP 
(PP 
apiResponsePP #
!=PP$ &
nullPP' +
&&PP, .
apiResponsePP/ :
.PP: ;
FirstOrDefaultPP; I
(PPI J
)PPJ K
.PPK L
KeyPPL O
!=PPP R
nullPPS W
)PPW X
{QQ 
stringRR 
keyRR "
=RR# $
apiResponseRR% 0
.RR0 1
FirstOrDefaultRR1 ?
(RR? @
)RR@ A
.RRA B
KeyRRB E
;RRE F
varUU 
existingProductUU +
=UU, -
_unitOfWorkUU. 9
.UU9 :
ProductRepositoryUU: K
.UUK L
GetFirstOrDefaultUUL ]
(UU] ^
pUU^ _
=>UU` b
pUUc d
.UUd e
EnglishNameUUe p
==UUq s
keyUUt w
)UUw x
;UUx y
ifWW 
(WW 
existingProductWW +
!=WW, .
nullWW/ 3
)WW3 4
{XX 
returnYY "
OkYY# %
(YY% &
$"YY& (
{YY( )
keyYY) ,
}YY, -
$strYY- 4
"YY4 5
)YY5 6
;YY6 7
}ZZ 
else[[ 
{\\ 
var^^ 

newProduct^^  *
=^^+ ,
new^^- 0
Product^^1 8
{__ 
EnglishName``  +
=``, -
key``. 1
,``1 2
	CreatedAtaa  )
=aa* +
DateTimeaa, 4
.aa4 5
UtcNowaa5 ;
}bb 
;bb 
_unitOfWorkdd '
.dd' (
ProductRepositorydd( 9
.dd9 :
Adddd: =
(dd= >

newProductdd> H
)ddH I
;ddI J
awaitee !
_unitOfWorkee" -
.ee- .
	SaveAsyncee. 7
(ee7 8
)ee8 9
;ee9 :
returngg "
Okgg# %
(gg% &
$"gg& (
{gg( )
keygg) ,
}gg, -
$strgg- 3
"gg3 4
)gg4 5
;gg5 6
}hh 
}ii 
returnjj 

BadRequestjj %
(jj% &
$strjj& <
)jj< =
;jj= >
}kk 
catchll 
(ll 
	Exceptionll  
exll! #
)ll# $
{mm 
returnnn 

BadRequestnn %
(nn% &
$"nn& (
$strnn( 3
{nn3 4
exnn4 6
.nn6 7
Messagenn7 >
}nn> ?
$strnn? S
"nnS T
)nnT U
;nnU V
}oo 
}pp 
}qq 	
[ss 	
HttpGetss	 
(ss 
$strss #
)ss# $
]ss$ %
publictt 
asynctt 
Tasktt 
<tt 
IActionResulttt '
>tt' (
UpdateProductLogtt) 9
(tt9 :
)tt: ;
{uu 	
stringvv 
urlvv 
=vv 
$strvv N
;vvN O
usingxx 
(xx 

HttpClientxx 

httpClientxx (
=xx) *
newxx+ .

HttpClientxx/ 9
(xx9 :
)xx: ;
)xx; <
{yy 
tryzz 
{{{ 
HttpResponseMessage|| '
response||( 0
=||1 2
await||3 8

httpClient||9 C
.||C D
GetAsync||D L
(||L M
url||M P
)||P Q
;||Q R
response}} 
.}} #
EnsureSuccessStatusCode}} 4
(}}4 5
)}}5 6
;}}6 7
string 
responseBody '
=( )
await* /
response0 8
.8 9
Content9 @
.@ A
ReadAsStringAsyncA R
(R S
)S T
;T U
var
ÄÄ 
apiResponse
ÄÄ #
=
ÄÄ$ %
JsonConvert
ÄÄ& 1
.
ÄÄ1 2
DeserializeObject
ÄÄ2 C
<
ÄÄC D

Dictionary
ÄÄD N
<
ÄÄN O
string
ÄÄO U
,
ÄÄU V
string
ÄÄW ]
>
ÄÄ] ^
>
ÄÄ^ _
(
ÄÄ_ `
responseBody
ÄÄ` l
)
ÄÄl m
;
ÄÄm n
if
ÇÇ 
(
ÇÇ 
apiResponse
ÇÇ #
!=
ÇÇ$ &
null
ÇÇ' +
&&
ÇÇ, .
apiResponse
ÇÇ/ :
.
ÇÇ: ;
FirstOrDefault
ÇÇ; I
(
ÇÇI J
)
ÇÇJ K
.
ÇÇK L
Value
ÇÇL Q
!=
ÇÇR T
null
ÇÇU Y
)
ÇÇY Z
{
ÉÉ 
string
ÑÑ 
responseKey
ÑÑ *
=
ÑÑ+ ,
apiResponse
ÑÑ- 8
.
ÑÑ8 9
FirstOrDefault
ÑÑ9 G
(
ÑÑG H
)
ÑÑH I
.
ÑÑI J
Key
ÑÑJ M
;
ÑÑM N
string
ÖÖ 
responseValue
ÖÖ ,
=
ÖÖ- .
apiResponse
ÖÖ/ :
.
ÖÖ: ;
FirstOrDefault
ÖÖ; I
(
ÖÖI J
)
ÖÖJ K
.
ÖÖK L
Value
ÖÖL Q
;
ÖÖQ R
var
àà 
lastProductLog
àà *
=
àà+ ,
_unitOfWork
àà- 8
.
àà8 9"
ProductLogRepository
àà9 M
.
ààM N
GetAllByFilter
ààN \
(
àà\ ]
u
àà] ^
=>
àà^ `
u
ààa b
.
ààb c
Product
ààc j
.
ààj k
EnglishName
ààk v
==
ààw y
responseKeyààz Ö
)ààÖ Ü
.ààÜ á!
OrderByDescendingààá ò
(ààò ô
uààô ö
=>ààö ú
uààù û
.ààû ü
	CreatedAtààü ®
)àà® ©
.àà© ™
FirstOrDefaultàà™ ∏
(àà∏ π
)ààπ ∫
;àà∫ ª
decimal
ää 
.
ää  
TryParse
ää  (
(
ää( )
responseValue
ää) 6
,
ää6 7
out
ää8 ;
decimal
ää< C
price
ääD I
)
ääI J
;
ääJ K
if
åå 
(
åå 
lastProductLog
åå *
==
åå+ -
null
åå. 2
)
åå2 3
{
çç 
int
éé 
	productId
éé  )
=
éé* +
_unitOfWork
éé, 7
.
éé7 8
ProductRepository
éé8 I
.
ééI J
GetFirstOrDefault
ééJ [
(
éé[ \
u
éé\ ]
=>
éé^ `
u
ééa b
.
ééb c
EnglishName
ééc n
==
ééo q
responseKey
éér }
)
éé} ~
.
éé~ 
Idéé Å
;ééÅ Ç
if
êê 
(
êê  
	productId
êê  )
==
êê* ,
$num
êê- .
)
êê. /
return
ëë  &
Ok
ëë' )
(
ëë) *
$str
ëë* Y
)
ëëY Z
;
ëëZ [
_unitOfWork
îî '
.
îî' ("
ProductLogRepository
îî( <
.
îî< =
Add
îî= @
(
îî@ A
new
îîA D

ProductLog
îîE O
(
îîO P
)
îîP Q
{
ïï 

Product_Id
ññ  *
=
ññ+ ,
	productId
ññ- 6
,
ññ6 7
Price
óó  %
=
óó& '
price
óó( -
,
óó- .
	CreatedAt
òò  )
=
òò* +
DateTime
òò, 4
.
òò4 5
Now
òò5 8
}
ôô 
)
ôô 
;
ôô 
await
õõ !
_unitOfWork
õõ" -
.
õõ- .
	SaveAsync
õõ. 7
(
õõ7 8
)
õõ8 9
;
õõ9 :
return
ùù "
Ok
ùù# %
(
ùù% &
$"
ùù& (
$str
ùù( D
{
ùùD E
responseKey
ùùE P
}
ùùP Q
$str
ùùQ b
{
ùùb c
responseValue
ùùc p
}
ùùp q
"
ùùq r
)
ùùr s
;
ùùs t
}
ûû 
else
üü 
{
†† 
if
°° 
(
°° 
lastProductLog
°° -
.
°°- .
Price
°°. 3
!=
°°4 6
price
°°7 <
)
°°< =
{
¢¢ 
_unitOfWork
££  +
.
££+ ,"
ProductLogRepository
££, @
.
££@ A
Add
££A D
(
££D E
new
££E H

ProductLog
££I S
(
££S T
)
££T U
{
§§  !

Product_Id
••$ .
=
••/ 0
lastProductLog
••1 ?
.
••? @

Product_Id
••@ J
,
••J K
Price
¶¶$ )
=
¶¶* +
price
¶¶, 1
,
¶¶1 2
	CreatedAt
ßß$ -
=
ßß. /
DateTime
ßß0 8
.
ßß8 9
Now
ßß9 <
}
®®  !
)
®®! "
;
®®" #
await
™™  %
_unitOfWork
™™& 1
.
™™1 2
	SaveAsync
™™2 ;
(
™™; <
)
™™< =
;
™™= >
return
¨¨  &
Ok
¨¨' )
(
¨¨) *
$"
¨¨* ,
$str
¨¨, D
{
¨¨D E
responseKey
¨¨E P
}
¨¨P Q
$str
¨¨Q [
{
¨¨[ \
lastProductLog
¨¨\ j
.
¨¨j k
Price
¨¨k p
}
¨¨p q
$str
¨¨q u
{
¨¨u v
responseValue¨¨v É
}¨¨É Ñ
"¨¨Ñ Ö
)¨¨Ö Ü
;¨¨Ü á
}
≠≠ 
return
ØØ "
Ok
ØØ# %
(
ØØ% &
$"
ØØ& (
$str
ØØ( D
{
ØØD E
responseKey
ØØE P
}
ØØP Q
$str
ØØQ d
{
ØØd e
responseValue
ØØe r
}
ØØr s
"
ØØs t
)
ØØt u
;
ØØu v
}
∞∞ 
}
±± 
return
≤≤ 

BadRequest
≤≤ %
(
≤≤% &
$str
≤≤& <
)
≤≤< =
;
≤≤= >
}
≥≥ 
catch
¥¥ 
(
¥¥ 
	Exception
¥¥  
ex
¥¥! #
)
¥¥# $
{
µµ 
return
∂∂ 

BadRequest
∂∂ %
(
∂∂% &
$"
∂∂& (
$str
∂∂( 3
{
∂∂3 4
ex
∂∂4 6
.
∂∂6 7
Message
∂∂7 >
}
∂∂> ?
$str
∂∂? S
"
∂∂S T
)
∂∂T U
;
∂∂U V
}
∑∑ 
}
∏∏ 
}
ππ 	
}
ªª 
public
ΩΩ 

class
ΩΩ *
Product_ProductLog_ViewModel
ΩΩ -
{
ææ 
public
øø 
int
øø 

Product_Id
øø 
{
øø 
get
øø  #
;
øø# $
set
øø% (
;
øø( )
}
øø* +
public
¿¿ 
string
¿¿ 
ProductName
¿¿ !
{
¿¿" #
get
¿¿$ '
;
¿¿' (
set
¿¿) ,
;
¿¿, -
}
¿¿. /
public
¡¡ 
string
¡¡ 
ProductIconName
¡¡ %
{
¡¡& '
get
¡¡( +
;
¡¡+ ,
set
¡¡- 0
;
¡¡0 1
}
¡¡2 3
public
¬¬ 
string
¬¬ 
Price
¬¬ 
{
¬¬ 
get
¬¬ !
;
¬¬! "
set
¬¬# &
;
¬¬& '
}
¬¬( )
public
√√ 
string
√√ 
Unit
√√ 
{
√√ 
get
√√  
;
√√  !
set
√√" %
;
√√% &
}
√√' (
public
ƒƒ 
string
ƒƒ 
CreateAt
ƒƒ 
{
ƒƒ  
get
ƒƒ! $
;
ƒƒ$ %
set
ƒƒ& )
;
ƒƒ) *
}
ƒƒ+ ,
}
≈≈ 
}∆∆ ïi
[C:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Controllers\PriceAlertController.cs
	namespace 	
Agah
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[		 
ApiController		 
]		 
public

 

class

  
PriceAlertController

 %
:

& '
ControllerBase

( 6
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
public  
PriceAlertController #
(# $
IUnitOfWork$ /

unitOfWork0 :
): ;
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
HttpPost	 
( 
$str ,
), -
]- .
public 
async 
Task 
< 
IActionResult '
>' ($
SetPriceRangeReservation) A
(A B
[B C
FromBodyC K
]K L
Reserve_ViewModelM ^
bodyContent_ j
)j k
{ 	
try 
{ 
var 
user 
= 
_unitOfWork &
.& '
UserRepository' 5
.5 6
GetFirstOrDefault6 G
(G H
uH I
=>J L
uM N
.N O
IdO Q
==R T
bodyContentU `
.` a
UserIda g
)g h
;h i
if 
( 
user 
== 
null  
)  !
return 

BadRequest %
(% &
new& )
{* +
message, 3
=4 5
$str6 F
}G H
)H I
;I J
var 
product 
= 
_unitOfWork )
.) *
ProductRepository* ;
.; <
GetFirstOrDefault< M
(M N
uN O
=>P R
uS T
.T U
IdU W
==X Z
bodyContent[ f
.f g
	ProductIdg p
)p q
;q r
if 
( 
product 
== 
null #
)# $
return 

BadRequest %
(% &
new& )
{* +
message, 3
=4 5
$str6 F
}G H
)H I
;I J
var!! 
alarm!! 
=!! 
_unitOfWork!! '
.!!' (
AlarmRepository!!( 7
.!!7 8
GetFirstOrDefault!!8 I
(!!I J
u!!J K
=>!!L N
u!!O P
.!!P Q
Id!!Q S
==!!T V
bodyContent!!W b
.!!b c
AlarmId!!c j
)!!j k
;!!k l
if"" 
("" 
alarm"" 
=="" 
null"" !
)""! "
return## 

BadRequest## %
(##% &
new##& )
{##* +
message##, 3
=##4 5
$str##6 F
}##G H
)##H I
;##I J
_unitOfWork&& 
.&& 
ReserveRepository&& -
.&&- .
Remove&&. 4
(&&4 5
_unitOfWork&&5 @
.&&@ A
ReserveRepository&&A R
.&&R S
GetFirstOrDefault&&S d
(&&d e
u&&e f
=>&&g i
u&&j k
.&&k l
User_Id&&l s
==&&t v
bodyContent	&&w Ç
.
&&Ç É
UserId
&&É â
)
&&â ä
)
&&ä ã
;
&&ã å
_unitOfWork)) 
.)) 
ReserveRepository)) -
.))- .
Add)). 1
())1 2
new))2 5
Reserve))6 =
())= >
)))> ?
{** 
User_Id++ 
=++ 
bodyContent++ )
.++) *
UserId++* 0
,++0 1
User,, 
=,, 
user,, 
,,,  

Product_Id-- 
=--  
bodyContent--! ,
.--, -
	ProductId--- 6
,--6 7
Product.. 
=.. 
product.. %
,..% &
Alarm_Id// 
=// 
bodyContent// *
.//* +
AlarmId//+ 2
,//2 3
Alarm00 
=00 
alarm00 !
,00! "
MinPrice11 
=11 
decimal11 &
.11& '
Parse11' ,
(11, -
bodyContent11- 8
.118 9
MinPrice119 A
.11A B
ToString11B J
(11J K
)11K L
.11L M
Replace11M T
(11T U
$str11U X
,11X Y
$str11Z \
)11\ ]
)11] ^
,11^ _
MaxPrice22 
=22 
decimal22 &
.22& '
Parse22' ,
(22, -
bodyContent22- 8
.228 9
MaxPrice229 A
.22A B
ToString22B J
(22J K
)22K L
.22L M
Replace22M T
(22T U
$str22U X
,22X Y
$str22Z \
)22\ ]
)22] ^
,22^ _
	CreatedAt33 
=33 
DateTime33  (
.33( )
Now33) ,
}44 
)44 
;44 
await77 
_unitOfWork77 !
.77! "
	SaveAsync77" +
(77+ ,
)77, -
;77- .
return:: 
Ok:: 
(:: 
new:: 
{:: 
message::  '
=::( )
$str::* E
}::F G
)::G H
;::H I
};; 
catch<< 
(<< 
	Exception<< 
ex<< 
)<<  
{== 
return>> 

BadRequest>> !
(>>! "
new>>" %
{>>& '
message>>( /
=>>0 1
$">>2 4
$str>>4 R
{>>R S
ex>>S U
.>>U V
Message>>V ]
}>>] ^
">>^ _
}>>` a
)>>a b
;>>b c
}?? 
}@@ 	
[BB 	
HttpGetBB	 
(BB 
$strBB 1
)BB1 2
]BB2 3
publicCC 
asyncCC 
TaskCC 
<CC 
IActionResultCC '
>CC' (!
CheckPriceInReservedsCC) >
(CC> ?
intCC? B
userIdCCC I
)CCI J
{DD 	
tryEE 
{FF 
varGG 
reserveGG 
=GG 
_unitOfWorkGG )
.GG) *
ReserveRepositoryGG* ;
.GG; <
GetFirstOrDefaultGG< M
(GGM N
uGGN O
=>GGP R
uGGS T
.GGT U
User_IdGGU \
==GG] _
userIdGG` f
,GGf g
uGGh i
=>GGi k
uGGl m
.GGm n
UserGGn r
,GGr s
uGGt u
=>GGu w
uGGx y
.GGy z
Product	GGz Å
,
GGÇ É
u
GGÉ Ñ
=>
GGÑ Ü
u
GGá à
.
GGà â
Alarm
GGâ é
)
GGé è
;
GGè ê
ifHH 
(HH 
reserveHH 
==HH 
nullHH #
)HH# $
returnII 

BadRequestII %
(II% &
newII& )
{II* +
messageII, 3
=II4 5
$strII6 c
}IId e
)IIe f
;IIf g
stringKK 
productNameKK "
=KK# $
_unitOfWorkKK% 0
.KK0 1
ProductRepositoryKK1 B
.KKB C
GetFirstOrDefaultKKC T
(KKT U
uKKU V
=>KKW Y
uKKZ [
.KK[ \
IdKK\ ^
==KK_ a
reserveKKb i
.KKi j

Product_IdKKj t
)KKt u
.KKu v
PersianName	KKv Å
;
KKÅ Ç
decimalNN 
lastProductsPriceNN )
=NN* +
_unitOfWorkNN, 7
.NN7 8 
ProductLogRepositoryNN8 L
.NNL M
GetAllNNM S
(NNS T
includePropertiesNNT e
:NNe f
uNNg h
=>NNi k
uNNl m
.NNm n
ProductNNn u
)NNu v
.OO 
WhereOO 
(OO 
uOO 
=>OO 
uOO  !
.OO! "

Product_IdOO" ,
==OO- /
reserveOO0 7
.OO7 8

Product_IdOO8 B
)OOB C
.PP 
OrderByDescendingPP &
(PP& '
uPP' (
=>PP) +
uPP, -
.PP- .
	CreatedAtPP. 7
)PP7 8
.QQ 
GroupByQQ 
(QQ 
uQQ 
=>QQ !
uQQ" #
.QQ# $

Product_IdQQ$ .
)QQ. /
.RR 
SelectRR 
(RR 
gRR 
=>RR  
gRR! "
.RR" #
FirstRR# (
(RR( )
)RR) *
)RR* +
.SS 
SelectSS 
(SS 
uSS 
=>SS  
uSS! "
.SS" #
PriceSS# (
)SS( )
.TT 
FirstOrDefaultTT #
(TT# $
)TT$ %
;TT% &
ifVV 
(VV 
lastProductsPriceVV %
<VV& '
reserveVV( /
.VV/ 0
MinPriceVV0 8
||VV9 ;
lastProductsPriceVV< M
>VVN O
reserveVVP W
.VVW X
MaxPriceVVX `
)VV` a
{WW 
NotificationServiceXX '
notificationServiceXX( ;
=XX< =
newXX> A
NotificationServiceXXB U
(XXU V
_unitOfWorkXXV a
)XXa b
;XXb c
awaitYY 
notificationServiceYY -
.YY- .
SendNotificationYY. >
(YY> ?
newYY? B'
Notification_MessageOptionsYYC ^
(YY^ _
)YY_ `
{ZZ 
User[[ 
=[[ 
reserve[[ &
.[[& '
User[[' +
,[[+ ,
NotificationType\\ (
=\\) *
reserve\\+ 2
.\\2 3
Alarm\\3 8
.\\8 9
EnglishName\\9 D
,\\D E
MessageSubject]] &
=]]' (
$"]]) +
$str]]+ 0
{]]0 1
reserve]]1 8
.]]8 9
Product]]9 @
.]]@ A
PersianName]]A L
}]]L M
$str]]M g
"]]g h
,]]h i
MessageContent^^ &
=^^' (
$"^^) +
$str^^+ 6
{^^6 7
productName^^7 B
}^^B C
$str^^C w
{^^w x
lastProductsPrice	^^x â
.
^^â ä
ToString
^^ä í
(
^^í ì
$str
^^ì ó
)
^^ó ò
}
^^ò ô
$str
^^ô ´
{
^^´ ¨
reserve
^^¨ ≥
.
^^≥ ¥
MinPrice
^^¥ º
.
^^º Ω
ToString
^^Ω ≈
(
^^≈ ∆
$str
^^∆  
)
^^  À
}
^^À Ã
$str
^^Ã œ
{
^^œ –
reserve
^^– ◊
.
^^◊ ÿ
MaxPrice
^^ÿ ‡
.
^^‡ ·
ToString
^^· È
(
^^È Í
$str
^^Í Ó
)
^^Ó Ô
}
^^Ô 
"
^^ Ò
,
^^Ò Ú
}__ 
)__ 
;__ 
return`` 
Ok`` 
(`` 
new`` !
{``" #
result``$ *
=``+ ,
$str``- U
}``V W
)``W X
;``X Y
}aa 
returnbb 
Okbb 
(bb 
newbb 
{bb 
resultbb  &
=bb' (
$strbb) G
}bbH I
)bbI J
;bbJ K
}cc 
catchdd 
(dd 
	Exceptiondd 
exdd 
)dd  
{ee 
returnff 

BadRequestff !
(ff! "
newff" %
{ff& '
messageff( /
=ff0 1
$"ff2 4
$strff4 R
{ffR S
exffS U
.ffU V
MessageffV ]
}ff] ^
"ff^ _
}ff` a
)ffa b
;ffb c
}gg 
}hh 	
[jj 	
HttpGetjj	 
(jj 
$strjj 
)jj 
]jj  
publickk 
asynckk 
Taskkk 
<kk 
IActionResultkk '
>kk' (
GetReserveskk) 4
(kk4 5
)kk5 6
{ll 	
varmm 
reservesUserIdListmm "
=mm# $
_unitOfWorkmm% 0
.mm0 1
ReserveRepositorymm1 B
.mmB C
GetAllmmC I
(mmI J
)mmJ K
;mmK L
returnoo 
Okoo 
(oo 
reservesUserIdListoo (
)oo( )
;oo) *
}pp 	
}qq 
publicss 

classss 
Reserve_ViewModelss "
{tt 
publicuu 
intuu 
UserIduu 
{uu 
getuu 
;uu  
setuu! $
;uu$ %
}uu& '
publicvv 
intvv 
	ProductIdvv 
{vv 
getvv "
;vv" #
setvv$ '
;vv' (
}vv) *
publicww 
intww 
AlarmIdww 
{ww 
getww  
;ww  !
setww" %
;ww% &
}ww' (
publicxx 
stringxx 
MinPricexx 
{xx  
getxx! $
;xx$ %
setxx& )
;xx) *
}xx+ ,
publicyy 
stringyy 
MaxPriceyy 
{yy  
getyy! $
;yy$ %
setyy& )
;yy) *
}yy+ ,
}zz 
}{{ ﬂ
]C:\Users\cc-mehdi\Desktop\Aware-Aghah\Backend\Agah\Agah\Controllers\NotificationController.cs
	namespace 	
Agah
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[		 
ApiController		 
]		 
public

 

class

 "
NotificationController

 '
:

( )
ControllerBase

* 8
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
public "
NotificationController %
(% &
IUnitOfWork& 1

unitOfWork2 <
)< =
{ 	
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
[ 	
HttpGet	 
( 
$str 8
)8 9
]9 :
public 
async 
Task 
< 
IActionResult '
>' (
GetNotifications) 9
(9 :
int: =
userId> D
,D E
stringF L
	alarmTypeM V
)V W
{ 	
try 
{ 
switch 
( 
	alarmType !
)! "
{ 
case 
$str  
:  !
var 
notificationsList -
=. /
_unitOfWork0 ;
.; <'
Notification_UserRepository< W
.W X
GetAllByFilterX f
(f g
ug h
=>i k
ul m
.m n
UserIdn t
==u w
userIdx ~
,~ 
includeProperties
Ä ë
:
ë í
u
ì î
=>
ï ó
u
ò ô
.
ô ö
User
ö û
)
û ü
.
ü †
OrderByDescending
† ±
(
± ≤
u
≤ ≥
=>
≥ µ
u
µ ∂
.
∂ ∑
	CreatedAt
∑ ¿
)
¿ ¡
;
¡ ¬
return 
Ok !
(! "
notificationsList" 3
)3 4
;4 5
default 
: 
break 
; 
} 
return!! 

BadRequest!! !
(!!! "
new!!" %
{!!& '
message!!( /
=!!0 1
$str!!2 b
}!!c d
)!!d e
;!!e f
}"" 
catch## 
(## 
	Exception## 
ex## 
)##  
{$$ 
return%% 

BadRequest%% !
(%%! "
new%%" %
{%%& '
message%%( /
=%%0 1
$"%%2 4
$str%%4 R
{%%R S
ex%%S U
.%%U V
Message%%V ]
}%%] ^
"%%^ _
}%%` a
)%%a b
;%%b c
}&& 
}'' 	
}(( 
public** 

class** '
Notification_MessageOptions** ,
{++ 
public,, 
string,, 
MessageSubject,, $
{,,% &
get,,' *
;,,* +
set,,, /
;,,/ 0
},,1 2
public-- 
string-- 
MessageContent-- $
{--% &
get--' *
;--* +
set--, /
;--/ 0
}--1 2
public.. 
string.. 
NotificationType.. &
{..' (
get..) ,
;.., -
set... 1
;..1 2
}..3 4
public// 
User// 
User// 
{// 
get// 
;// 
set//  #
;//# $
}//% &
}00 
}11 